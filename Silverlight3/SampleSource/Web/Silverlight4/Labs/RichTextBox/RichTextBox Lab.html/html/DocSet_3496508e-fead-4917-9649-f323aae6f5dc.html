<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 1 – Getting Started" />
      <MSHelp:RLTitle Title="Exercise 1 – Getting Started" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 1 – Getting Started</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Silverlight RichTextBox Lab</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 1 – Getting Started</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>The goal of this exercise is to familiarize the student with the existing starter application and add new functionality into the application.  </p>
        <ol>
          <li>Start Visual Studio 2010</li>
          <li>On the <b>File</b> menu click <b>Open</b><b>Project/Solution…</b><ol><li>Alternatively, from Visual Studio Start Page click <b>Open Project…</b><ol><li> At the Open Project dialog navigate to the Lab installation folder</li><li>Navigate to RichTextBox\Source\Ex01\Begin folder</li><li>Click the <b>RichTextBox.sln</b> file and then click the <b>Open</b> button</li></ol></li></ol></li>
          <li>The project will not currently build since we'll be adding specific functionality. You can ignore any warnings that may appear at this point.</li>
          <li>Set the RichTextBox.Web project as the startup project by right clicking the project in the Solution Explorer and selecting “Set as Startup Project”</li>
        </ol>
        <br />
        <br />
        <a name="_Toc244134678" href="#">
          <span />
        </a>
        <a name="_Toc256194577" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Building a Text Editor UI</b>
        </p>
        <p>In order to use the rich text formatting offered by the <b>RichTextBox</b> control we need a set of buttons that will allow end users to perform text formatting functions. We'll start by building a ribbon user interface much like you've seen in Word 2007 or higher.</p>
        <ol>
          <li>If you haven't opened the Starter project open it now (see previous section for detailed instructions)</li>
          <li>Double-click the XAML tab below the designer window to open the XAML code editor in full screen mode</li>
          <li>Open MainPage.xaml and locate the &lt;!-- RichTextBoxControl --&gt; comment. Replace the existing RichTextBox element with the following:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;RichTextBox x:Name="rtb" SelectionChanged="rtb_SelectionChanged"   VerticalScrollBarVisibility="Auto" KeyUp="rtb_KeyUp"  BorderBrush="{x:Null}" Margin="8,10,10,8" FontSize="20" TextWrapping="Wrap"   MouseRightButtonDown="rtb_MouseRightButtonDown"   MouseRightButtonUp="rtb_MouseRightButtonUp" MouseMove="rtb_MouseMove"   DragEnter="rtb_DragEnter" DragLeave="rtb_DragLeave"/&gt;</pre></td></tr></table></span></div></li>
          <li>In MainPage.xaml file. Scroll to the bottom and locate &lt;!-- TODO Toolbar goes here --&gt;  which is located toward the bottom of the file. We will add a Grid after this comment to create containers and placeholders for buttons.  Add the following code:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;Grid Margin="3,3,3,1"&gt;    &lt;Grid.RowDefinitions&gt;        &lt;RowDefinition Height="27"/&gt;        &lt;RowDefinition/&gt;    &lt;/Grid.RowDefinitions&gt;    &lt;Grid.ColumnDefinitions&gt;        &lt;ColumnDefinition Width="102"/&gt;        &lt;ColumnDefinition Width="176"/&gt;        &lt;ColumnDefinition Width="184"/&gt;        &lt;ColumnDefinition Width="73"/&gt;        &lt;ColumnDefinition Width="106"/&gt;        &lt;ColumnDefinition Width="80"/&gt;        &lt;ColumnDefinition Width="80"/&gt;        &lt;ColumnDefinition/&gt;    &lt;/Grid.ColumnDefinitions&gt;    &lt;Rectangle Margin="0,-26,0,2" Grid.RowSpan="1" Fill="{StaticResource      MenuDividerBrush}" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="1" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="2" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="3" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="4" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="5" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="6" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;Rectangle Margin="2,-26,0,2" Fill="{StaticResource MenuDividerBrush}"      Grid.Column="7" Grid.Row="1" RadiusX="2" RadiusY="2" Stroke="#FFA5BED4"/&gt;    &lt;!-- TODO - Font Buttons--&gt;    &lt;!-- TODO - Clipboard Buttons--&gt;    &lt;!-- TODO - Insert Buttons--&gt;    &lt;!-- TODO - Print Button--&gt;    &lt;!-- TODO - Display, Highlight, Xaml Buttons--&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Clipboard" Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Font" Grid.Column="1"      Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Insert" Grid.Column="2"      Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Print" Grid.Column="3"      Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Display" Grid.Column="4"      Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="Highlight"      Grid.Column="5" Grid.Row="1"/&gt;    &lt;TextBlock Style="{StaticResource MenuLabel}" Text="XAML" Grid.Column="6"      Grid.Row="1"/&gt;&lt;/Grid&gt;</pre></td></tr></table></span></div></li>
          <li>Press<b> F5 </b>to Run the application. Notice the Grid has columns to act as placeholders for the buttons and functionality that will be added.<a name="_Toc244134679" href="#"><span /></a><p><img src="images\67e0f16d-f973-4839-9560-e2d12775727c.png" /></p><p><b>Figure 1</b><br /><i>Browser showing grid with placeholder for buttons</i></p></li>
          <li>Now we'll load a file to pre-populate the RichTextBox with some formatted Xaml text. Open MainPage.xaml.cs file and near the top of the file locate // TODO Add sample Xaml file here in the MainPage_Loaded event. Add the following code to load from a file named SampleNew.sav and assign to the RichTextBox control's Xaml property:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>StreamResourceInfo sr = App.GetResourceStream(new   Uri("/RichNotepad;component/sampleNew.sav", UriKind.Relative));StreamReader sread = new StreamReader(sr.Stream);string xaml = sread.ReadToEnd();rtb.Xaml = xaml;sread.Close();</pre></td></tr></table></span></div></li>
          <li>Press F5 to run the project and notice that we now have formatted text loaded into the RichTextBox control.<p><img src="images\d9bdb459-3c0b-4058-a21e-6d44259cb40e.png" /></p><p><b>Figure 2</b><br /><i>Browser showing dynamic text loaded</i></p></li>
          <li>Close the browser and return back to Visual Studio</li>
          <li>Go to MainPage.xaml and scroll to the bottom. Locate the &lt;!-- TODO - Font Buttons--&gt; comment.  Insert the following code to add the font formatting buttons:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;!--Fonts Face Combo--&gt;&lt;ComboBox x:Name="cmbFonts" FontFamily="{Binding SelectedItem.FontFamily,   RelativeSource={RelativeSource Self}}" FontSize="{Binding   SelectedItem.FontSize, RelativeSource={RelativeSource Self}}" Grid.Column="1"   Margin="6,0,55,0" Height="22" VerticalAlignment="Bottom" &gt;    &lt;ComboBoxItem Content="Arial" Tag="Arial" FontFamily="Arial" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Arial Black" Tag="Arial Black" FontFamily="Arial      Black" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Calibri" Tag="Calibri" FontFamily="Calibri"      IsSelected="True" FontSize="14"/&gt;    &lt;ComboBoxItem Content="Comic Sans MS" Tag="Comic Sans MS"      FontFamily="Comic Sans MS" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Courier New" Tag="Courier New"      FontFamily="Courier New" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Georgia" Tag="Georgia" FontFamily="Georgia"      FontSize="12"/&gt;    &lt;ComboBoxItem Content="Lucida Sans Unicode" Tag="Lucida Sans Unicode"      FontFamily="Lucida Sans Unicode" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Portable User Interface" Tag="{x:Null}"      FontFamily="Portable User Interface" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Times New Roman" Tag="Times New Roman"      FontFamily="Times New Roman" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Trebuchet MS" Tag="Trebuchet MS"      FontFamily="Trebuchet MS" FontSize="12"/&gt;    &lt;ComboBoxItem Content="Verdana" Tag="Verdana" FontFamily="Verdana"      FontSize="12"/&gt;    &lt;ComboBoxItem Content="Webdings" Tag="Webdings" FontSize="12"/&gt;&lt;/ComboBox&gt;&lt;ComboBox x:Name="cmbFontSizes" Width="44" FontSize="14"  HorizontalAlignment="Right" Margin="0,0,6,0" Grid.Column="1" Height="22" VerticalAlignment="Bottom"&gt;    &lt;ComboBoxItem Content="8" Tag="8"/&gt;    &lt;ComboBoxItem Content="9" Tag="9"/&gt;    &lt;ComboBoxItem Content="10" Tag="10"/&gt;    &lt;ComboBoxItem Content="11" Tag="11"/&gt;    &lt;ComboBoxItem Content="12" Tag="12"/&gt;    &lt;ComboBoxItem Content="14" Tag="14"/&gt;    &lt;ComboBoxItem Content="16" Tag="16" IsSelected="True"/&gt;    &lt;ComboBoxItem Content="18" Tag="18"/&gt;    &lt;ComboBoxItem Content="20" Tag="20"/&gt;    &lt;ComboBoxItem Content="22" Tag="22"/&gt;    &lt;ComboBoxItem Content="24" Tag="24"/&gt;    &lt;ComboBoxItem Content="26" Tag="26"/&gt;    &lt;ComboBoxItem Content="28" Tag="28"/&gt;    &lt;ComboBoxItem Content="36" Tag="36"/&gt;    &lt;ComboBoxItem Content="48" Tag="48"/&gt;    &lt;ComboBoxItem Content="72" Tag="72"/&gt;&lt;/ComboBox&gt;&lt;StackPanel Grid.Column="1" Height="22" Margin="6,5,0,0" Orientation="Horizontal"   Grid.Row="1" VerticalAlignment="Top"&gt;    &lt;!--Font Formatting Buttons--&gt;    &lt;Button x:Name="btnBold" Margin="0,0,1,0"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="{Binding tooltip_Bold,              Source={StaticResource localizedStrings}}"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/Bold.png" d:IsLocked="True"/&gt;    &lt;/Button&gt;    &lt;Button x:Name="btnItalic" Margin="0,0,1,0"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="{Binding tooltip_Italic,               Source={StaticResource localizedStrings}}"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/Italic.png"/&gt;    &lt;/Button&gt;    &lt;Button x:Name="btnUnderline" Margin="0,0,13,0"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="Underline"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/Underline.png"/&gt;    &lt;/Button&gt;    &lt;ComboBox x:Name="cmbFontColors" SelectedIndex="0" Margin="39,0,0,0"      HorizontalAlignment="Right"&gt;        &lt;ComboBoxItem Tag="FFFF0000"&gt;            &lt;Rectangle Width="22" Height="14" Fill="Red" Margin="2,0,0,0" /&gt;        &lt;/ComboBoxItem&gt;        &lt;ComboBoxItem Tag="FF008000"&gt;            &lt;Rectangle Width="22" Height="14" Fill="Green" Margin="2,0,0,0" /&gt;        &lt;/ComboBoxItem&gt;        &lt;ComboBoxItem Tag="FF0000FF"&gt;            &lt;Rectangle Width="22" Height="14" Fill="Blue" Margin="2,0,0,0" /&gt;        &lt;/ComboBoxItem&gt;        &lt;ComboBoxItem Tag="FFFFFF00"&gt;            &lt;Rectangle Width="22" Height="14" Fill="Yellow" Margin="2,0,0,0" /&gt;        &lt;/ComboBoxItem&gt;        &lt;ComboBoxItem Tag="FF000000" IsSelected="True"&gt;            &lt;Rectangle Width="22" Height="14" Fill="Black" Margin="2,0,0,0" /&gt;        &lt;/ComboBoxItem&gt;    &lt;/ComboBox&gt;&lt;/StackPanel&gt;</pre></td></tr></table></span></div></li>
          <li>In the code you just inserted into MainPage.xaml, find the button named <b>btnBold</b>. Add a new Click event handler (use the default name).<p><img src="images\c6890af2-1e06-4456-801d-32fdb2d5fb22.png" /></p><p><b>Figure 3</b><br /><i>Event Handler Generation from XAML Editor</i></p></li>
          <li>Right-click  btnBold_Click and select Navigate to Event Handler from the context menu<p><img src="images\0165a7ac-28c1-47f2-8098-4edc0bc15bf5.png" /></p><p><b>Figure 4</b><br /><i>Navigate to Event Handler from XAML Editor</i></p></li>
          <li>The last action will take you into the source code editor and to the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>private void btnBold_Click(object sender, RoutedEventArgs e){}    </pre></td></tr></table></span></div></li>
          <li>Since we want to set the selected text to bold, we'll add the following <b>if</b> statement to check whether the user selected some text prior to pressing the button. Add the following code in the btnBold_Click method:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){}ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Once we have a selection, all that is left to do is to change the font's weight from normal to bold or vice versa according to whether the button is toggled or not. We'll need to check the current font style and apply the opposite (in case the selection is mixed we'll remove the bold style). Add the following code inside the <b>if</b> statement to perform the style modification:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb.Selection.GetPropertyValue(Run.FontWeightProperty) is FontWeight &amp;&amp;((FontWeight)rtb.Selection.GetPropertyValue(Run.FontWeightProperty)) == FontWeights.Normal)rtb.Selection.ApplyPropertyValue(Run.FontWeightProperty, FontWeights.Bold);elsertb.Selection.ApplyPropertyValue(Run.FontWeightProperty, FontWeights.Normal);</pre></td></tr></table></span></div></li>
          <li>Add a Click event handler for <b>btnItalic</b> (following the same process you followed for btnBold above).</li>
          <li>Place the following code in the btnItalic_Click event handler and take a moment to look through the code.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){if (rtb.Selection.GetPropertyValue(Run.FontStyleProperty) is FontStyle &amp;&amp;((FontStyle)rtb.Selection.GetPropertyValue(Run.FontStyleProperty)) == FontStyles.Normal)rtb.Selection.ApplyPropertyValue(Run.FontStyleProperty, FontStyles.Italic);elsertb.Selection.ApplyPropertyValue(Run.FontStyleProperty, FontStyles.Normal);}ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Add a Click event handler for <b>btnUnderline</b></li>
          <li>Place the following code in the btnUnderline_Click event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){if (rtb.Selection.GetPropertyValue(Run.TextDecorationsProperty) == null)                                       rtb.Selection.ApplyPropertyValue(Run.TextDecorationsProperty, TextDecorations.Underline);elsertb.Selection.ApplyPropertyValue(Run.TextDecorationsProperty, null);}ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Next, we'll handle font family changes. When the user changes the font in the fonts ComboBox control, we'll change the font family of the current selected text. Find the ComboBox named <b>cmbFonts</b> and add an event handler for the SelectionChanged event. </li>
          <li>Add the following code into the cmbFonts_SelectionChanged event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){rtb.Selection.ApplyPropertyValue(Run.FontFamilyProperty,new FontFamily((cmbFonts.SelectedItem as ComboBoxItem).Tag.ToString()));}ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Let's do the same to modify the text size. Find the ComboBox named <b>cmbFontSizes</b>, add a default event handler for the SelectionChanged event and add the following code to the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){rtb.Selection.ApplyPropertyValue(Run.FontSizeProperty, double.Parse((cmbFontSizes.SelectedItem as ComboBoxItem).Tag.ToString()));}ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Find the <b>cmbFontColors</b> ComboBox and examine how each color is represented as a string of HEX values representing the color and stored in the "Tag" property of the ComboBoxItem element. In order to break that string into ARGB (Alpha/Red/Green/Blue) format, we'll need to do some parsing. </li>
          <li>Create a default event handler for the SelectionChanged event of <b>cmbFontColors</b> and add the following code to the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>if (rtb != null &amp;&amp; rtb.Selection.Text.Length &gt; 0){string color = (cmbFontColors.SelectedItem as ComboBoxItem).Tag.ToString();SolidColorBrush brush = new SolidColorBrush(Color.FromArgb(byte.Parse(color.Substring(0, 2), System.Globalization.NumberStyles.HexNumber),byte.Parse(color.Substring(2, 2), System.Globalization.NumberStyles.HexNumber),byte.Parse(color.Substring(4, 2), System.Globalization.NumberStyles.HexNumber),byte.Parse(color.Substring(6, 2), System.Globalization.NumberStyles.HexNumber)));rtb.Selection.ApplyPropertyValue(Run.ForegroundProperty, brush);}</pre></td></tr></table></span></div></li>
          <li>Run the application by pressing F5. </li>
          <li>Enter some text (or use the pre-loaded text), select it and press the bold button. The text has become bold. Press the bold button again and the text will return to normal. If you select mixed text (some characters bold and some normal) and press the bold button, the text will return to normal. Try experimenting with the other text formatting features including fonts and font colors.</li>
        </ol>
        <br />
        <a name="_Toc244134682" href="#">
          <span />
        </a>
        <br />
        <a name="_Toc256194578" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Embedded Elements</b>
        </p>
        <p>In this exercise we will allow users to add hyperlinks, images, datagrids and calendars into the RichTextBox control.</p>
        <ol>
          <li>In MainPage.xaml locate the comment &lt;!-- TODO - Insert Buttons--&gt; and insert the following code to create the buttons for inserting an image, hyperlink, DataGrid and calendar.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;Button x:Name="btnImage"  HorizontalAlignment="Left" Grid.Column="2"   Margin="13,-22,0,24" Grid.RowSpan="1" Grid.Row="1"&gt;    &lt;ToolTipService.ToolTip&gt;        &lt;ToolTip FontSize="16" Content="{Binding tooltip_Image,           Source={StaticResource localizedStrings}}"/&gt;    &lt;/ToolTipService.ToolTip&gt;    &lt;Image Source="Images/Image.png" Height="32" Width="30"/&gt;&lt;/Button&gt;&lt;Button x:Name="btnHyperlink"  Grid.Column="2" Margin="55,-22,0,24"   Grid.RowSpan="1" Grid.Row="1" HorizontalAlignment="Left"&gt;    &lt;ToolTipService.ToolTip&gt;        &lt;ToolTip FontSize="16" Content="{Binding tooltip_Hyperlink,          Source={StaticResource localizedStrings}}"/&gt;    &lt;/ToolTipService.ToolTip&gt;    &lt;Image Source="Images/Hyperlink_big.png" Width="30" Height="32"/&gt;&lt;/Button&gt;&lt;Button x:Name="btnDatagrid"  Grid.Column="2" Grid.RowSpan="1"   Margin="97,-22,0,24" HorizontalAlignment="Left" Grid.Row="1"&gt;    &lt;ToolTipService.ToolTip&gt;        &lt;ToolTip FontSize="16" Content="Insert Datagrid"/&gt;    &lt;/ToolTipService.ToolTip&gt;    &lt;Image Source="Images/datagrid.png" Width="29" Height="32"/&gt;&lt;/Button&gt;&lt;Button x:Name="btnCalendar"  Grid.Column="2" Grid.RowSpan="1"   Margin="138,-22,0,24" HorizontalAlignment="Left" Grid.Row="1"&gt;    &lt;ToolTipService.ToolTip&gt;        &lt;ToolTip FontSize="16" Content="Insert Calendar"/&gt;    &lt;/ToolTipService.ToolTip&gt;    &lt;Image Source="Images/calendar.png" Width="29" Height="32"/&gt;&lt;/Button&gt;                </pre></td></tr></table></span></div></li>
          <li> Locate the <b>btnImage</b> button. Add a default event handler for the Click event and navigate to the event handler.</li>
          <li>In order to add an image to the RichTextBox we need to create an InlineUIContainer object that will contain the image presented by the RichTextBox. Add the following code to the btnImage_Click event handler function:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>InlineUIContainer container = new InlineUIContainer();container.Child = getImage();rtb.Selection.Insert(container);ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Now that we have a container, we can load a sample image into it (you can find the image in the ClientBin folder of the Web Project). Add the following code into MainPage.xaml.cs to create a method capable of loading an image and placing it in the container:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>private Image getImage(){    return CreateImageFromUri(new Uri("desert.jpg",       UriKind.RelativeOrAbsolute), 200, 150);}</pre></td></tr></table></span></div></li>
          <li>Compile and run the application by pressing F5. Press the insert image button and an image will appear in the RichTextBox control.</li>
          <li>To add a hyperlink to the RichTextBox control we'll use a child window to allow the user to input a hyperlink and a description for it.  The ChildWindow class was introduced in Silverlight 3 and is used to implement popup windows you can interact with. Find the file InsertURL.xaml and the file InsertURL.xaml.cs and take a moment to look through their code. Examine the validation code in the InsertURL.xaml.cs class.</li>
          <li>Back in MainPage.xaml, find the <b>btnHyperlink</b> button and add an event handler for the Click event.  To show the InsertURL child window add the following code to the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>InsertURL cw = new InsertURL(rtb.Selection.Text);cw.HasCloseButton = false;cw.Show();</pre></td></tr></table></span></div></li>
          <li>The previous code will show the child window, but after confirming the URL we need to fetch it from the child window and place it in the RichTextBox. Add the following code to handle the Close event of the child window (place the code <s>before</s> calling the Show method)<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>cw.Closed += (s, args) =&gt;{if (cw.DialogResult.Value){}};</pre></td></tr></table></span></div></li>
          <li>Next, we'll create a Hyperlink object and place it inside the RichTextBox. Place the following code inside the <b>if</b> statement from the last step.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Hyperlink hyperlink = new Hyperlink();hyperlink.TargetName = "_blank";hyperlink.NavigateUri = new Uri(cw.txtURL.Text);if (cw.txtURLDesc.Text.Length &gt; 0)hyperlink.Inlines.Add(cw.txtURLDesc.Text);elsehyperlink.Inlines.Add(cw.txtURL.Text);rtb.Selection.Insert(hyperlink);</pre></td></tr></table></span></div></li>
          <li>Locate the <b>btnDatagrid</b> button in MainPage.xaml, add a Click event handler and add the following code into the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>InlineUIContainer container = new InlineUIContainer();container.Child = getDataGrid();rtb.Selection.Insert(container);ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Add the following method into the MainPage.xaml.cs file to create a new DataGrid instance:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>private DataGrid getDataGrid(){    DataGrid dg = new DataGrid();    dg.AutoGenerateColumns = true;    dg.Width = 500;    dg.Height = 150;    dg.ItemsSource = Customer.GetSampleCustomerList();    dg.Style = (Style)this.Resources["DataGridStyle1"];    return dg;}</pre></td></tr></table></span></div></li>
          <li>Locate the <b>btnCalendar</b> button in MainPage.xaml, add a Click event handler and add the following code into the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>InlineUIContainer container = new InlineUIContainer();container.Child = getCalendar();rtb.Selection.Insert(container);ReturnFocus();</pre></td></tr></table></span></div></li>
          <li>Add the following method into the MainPage.xaml.cs file to create a new Calendar instance:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>private Calendar getCalendar(){    Calendar cal = new Calendar();    cal.Width = 179;    cal.Height = 169;    cal.FontFamily = new FontFamily("Portable User Interface");    cal.Style = (Style)this.Resources["CalendarStyle1"];    return cal;}</pre></td></tr></table></span></div></li>
          <li>At this point we've seen that InlineUIContainer can act as the container for different types of objects. Compile and run the application by pressing F5. Press the image, hyperlink, datagrid and calendar buttons to test the functionality.</li>
        </ol>
        <a name="_Toc244134683" href="#">
          <span />
        </a>
        <a name="_Toc256194579" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Persisting content</b>
        </p>
        <p>Now that our editor supports inputting text and styling it let's see how we can save documents.  </p>
        <ol>
          <li>Open Mainpage.xaml, locate the comment remark &lt;!-- TODO - Open, Save, New Buttons--&gt;, and add the following stack panel control which will house our New, Open, and Save buttons.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;StackPanel Grid.RowSpan="1" Grid.Column="4" Margin="8" VerticalAlignment="Top"   HorizontalAlignment="Right" Orientation="Horizontal" Grid.Row="0"&gt;    &lt;!--New Button--&gt;    &lt;Button  x:Name="btnNew" HorizontalAlignment="Left" Height="22"      Margin="0,0,0,0" VerticalAlignment="Top" Width="22"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="{Binding tooltip_New,               Source={StaticResource localizedStrings}}"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/New.png"/&gt;    &lt;/Button&gt;    &lt;!--Open Existing Button --&gt;    &lt;Button  x:Name="btnOpen" HorizontalAlignment="Left" Height="22"       Margin="0,0,0,4" VerticalAlignment="Top" Width="22"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="{Binding tooltip_Open,               Source={StaticResource localizedStrings}}"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/Open.png"/&gt;    &lt;/Button&gt;    &lt;!--Save Existing Button --&gt;    &lt;Button x:Name="btnSave" HorizontalAlignment="Left" Height="22"      VerticalAlignment="Top" Width="22"&gt;        &lt;ToolTipService.ToolTip&gt;            &lt;ToolTip FontSize="16" Content="{Binding tooltip_Save,              Source={StaticResource localizedStrings}}"/&gt;        &lt;/ToolTipService.ToolTip&gt;        &lt;Image Source="Images/Save.png"/&gt;    &lt;/Button&gt;&lt;/StackPanel&gt;</pre></td></tr></table></span></div></li>
          <li>In MainPage.xaml locate the <b>btnNew</b> button and add a default event handler for the Click event.  Add the following code to the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>bool clear = true;if (IsDirty){    if (MessageBox.Show("All changes will be lost. Continue?",        "Continue", MessageBoxButton.OKCancel) == MessageBoxResult.Cancel)    {        clear = false;    }}if (clear){    rtb.Blocks.Clear();    IsDirty = false;}</pre></td></tr></table></span></div></li>
          <li>Go back to the MainPage.xaml, locate the <b>btnSave</b> button and add a default event handler for the Click event. Add the following into the event handler:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>string xaml = rtb.Xaml;SaveFileDialog sfd = new SaveFileDialog();sfd.DefaultExt = ".sav";sfd.Filter = "Saved Files|*.sav|All Files|*.*";if (sfd.ShowDialog().Value){}</pre></td></tr></table></span></div></li>
          <li>All that is left to do is take the content, write it into the selected file and reset an IsDirty variable. Add the following code inside the <b>if</b> statement:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>using (FileStream fs = (FileStream)sfd.OpenFile()){    System.Text.UTF8Encoding enc = new System.Text.UTF8Encoding();    byte[] buffer = enc.GetBytes(xaml);    fs.Write(buffer, 0, buffer.Length);    fs.Close();    IsDirty = false;}</pre></td></tr></table></span></div></li>
          <li>Before we can test this code, we need to be able to open the saved file. Go to MainPage.xaml and locate the <b>btnOpen</b> button. Add a default event handler for the Click event and navigate to it. </li>
          <li>Next we'll use the OpenFileDialog class to ask the user to select which document to open. Place the following code after calling the btnOpen_Click method:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>OpenFileDialog ofd = new OpenFileDialog();ofd.Multiselect = false;ofd.Filter = "Saved Files|*.sav|All Files|*.*";if (ofd.ShowDialog().Value){}</pre></td></tr></table></span></div></li>
          <li>Add the following code into the <b>if</b> statement:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>FileInfo fi = ofd.File;using (StreamReader reader = fi.OpenText()){    rtb.Xaml = reader.ReadToEnd();}</pre></td></tr></table></span></div></li>
          <li>Compile and run the application by pressing F5. Enter some text and test the save and load features. </li>
        </ol>
        <br />
        <br />
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to jopapa@microsoft.com<p />Copyright © 2010 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>