<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 2 –Binding &amp; Validation Features" />
      <MSHelp:RLTitle Title="Exercise 2 –Binding &amp; Validation Features" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 2 –Binding &amp; Validation Features</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Silverlight Validation, Binding, DataForm and DataGrid Lab</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 2 –Binding &amp; Validation Features</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>The goal of this exercise is to familiarize the student with the new Binding &amp; Validation features in Silverlight 4. Silverlight 4 allows you to change how data is formatted without having to implement and apply an IValueConverter. Additionally, you can decide what to do when binding fails to return data and choose how to validate data more easily.</p>
        <p>In the previous exercise, we removed some of the columns displayed in the DataGrid. In order to see the employees' complete information, we'll add a simple form view to the application, which will show the employee's properties for the selected employee in the DataGrid. </p>
        <p>You can continue building on your work from Exercise 1.  If you had problems with Exercise 1, you can navigate to “EmployeeManager\Source\Ex02\begin” folder and open the “EmployeeManager.sln” to continue.</p>
        <a name="_Toc256193478" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Binding to Dependency Properties </b>
        </p>
        <ol>
          <li>Add a new item to the EmployeeManager project item by right clicking on the project and selecting <b>Add</b><b>New Item…</b><p><img src="images\07789b4d-cc09-42f5-8c07-20b9a8b827ab.png" /></p><p><b>Figure 1</b><br /><i>Add New Item To the Project</i></p></li>
          <li>From “Add New Item - EmployeeManager” dialog select “Silverlight Templated Control”, name it EmployeeDataForm.cs and click “Add”.<p><img src="images\754816fa-664d-4949-b0ee-f81c60bfab9b.png" /></p><p><b>Figure 2</b><br /><i>Add New Item Dialog Box</i></p></li>
          <li>Once the control has been added, the new control's code will open in Visual Studio (the file "EmployeeDataForm.cs"). Replace the code in the file with the following code (you can cut and paste the code from the lab exercise document available on the lab machine):<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>using System;using System.Collections.Generic;using System.Linq;using System.Net;using System.Windows;using System.Windows.Controls;using System.Windows.Documents;using System.Windows.Input;using System.Windows.Media;using System.Windows.Media.Animation;using System.Windows.Shapes;namespace EmployeeManager{  [TemplatePart(Name = "txtFirstName", Type=typeof(TextBox)),   TemplatePart(Name = "txtLastName", Type = typeof(TextBox)),   TemplatePart(Name = "txtBirthday", Type = typeof(TextBox)),   TemplatePart(Name = "txtGroup", Type = typeof(TextBox)),   TemplatePart(Name = "txtPhoneNumber", Type = typeof(TextBox)),   TemplatePart(Name = "txtAddress", Type = typeof(TextBox)),   TemplatePart(Name = "txtIncome", Type = typeof(TextBox)),   TemplatePart(Name = "txtTaxPercent", Type = typeof(TextBox)),   TemplatePart(Name = "txtNationalID", Type = typeof(TextBox))]  public class EmployeeDataForm : Control  {    public EmployeeDataForm()    {      this.DefaultStyleKey = typeof(EmployeeDataForm);      this.DataContext = this;    }    public bool IsLocked    {      get { return (bool)GetValue(IsLockedProperty); }      set { SetValue(IsLockedProperty, value); }    }    // Using a DependencyProperty as the backing store for IsEditing.  This enables animation, styling, binding, etc...    public static readonly DependencyProperty IsLockedProperty =        DependencyProperty.Register("IsLocked", typeof(bool),   typeof(EmployeeDataForm), null);    public bool IsValid    {      get { return !HasBindingErrors(); }    }    public Employee TheEmployee    {      get { return (Employee)GetValue(TheEmployeeProperty); }      set { SetValue(TheEmployeeProperty, value); }    }    // Using a DependencyProperty as the backing store for TheEmployee.  This enables animation, styling, binding, etc...    public static readonly DependencyProperty TheEmployeeProperty =        DependencyProperty.Register("TheEmployee", typeof(Employee), typeof(EmployeeDataForm), null);    private bool HasBindingErrors()    {      bool res = false; //assume success      res |= Validation.GetHasError(GetTemplateChild("txtFirstName"));      res |= Validation.GetHasError(GetTemplateChild("txtLastName"));      res |= Validation.GetHasError(GetTemplateChild("txtBirthday"));      res |= Validation.GetHasError(GetTemplateChild("txtGroup"));      res |= Validation.GetHasError(GetTemplateChild("txtPhoneNumber"));      res |= Validation.GetHasError(GetTemplateChild("txtAddress"));      res |= Validation.GetHasError(GetTemplateChild("txtIncome"));      res |= Validation.GetHasError(GetTemplateChild("txtTaxPercent"));      res |= Validation.GetHasError(GetTemplateChild("txtNationalID"));      return res;    }  }}</pre></td></tr></table></span></div></li>
          <li>The code you've pasted uses 9 TextBoxes to show the employee's information. To build the UI needed for this control, open the "Generic.xaml" file located in the “Themes” folder (automatically created by Visual Studio while adding new Templated Controls).You may receive an error when opening this file if using design or split-view - this is normal because there is nothing to display in the design view for this page.</li>
          <li>Replace the content of the "Generic.xaml" file with the following content (this is the UI XAML for the control)<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;ResourceDictionary     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"    xmlns:local="clr-namespace:EmployeeManager"&gt;    &lt;Style x:Key="tb" TargetType="TextBlock"&gt;        &lt;Setter Property="VerticalAlignment" Value="Center"/&gt;                &lt;Setter Property="Margin" Value="3"/&gt;    &lt;/Style&gt;    &lt;Style TargetType="local:EmployeeDataForm"&gt;        &lt;Setter Property="Template"&gt;            &lt;Setter.Value&gt;                &lt;ControlTemplate TargetType="local:EmployeeDataForm"&gt;                    &lt;Border Background="{TemplateBinding Background}"                            BorderBrush="{TemplateBinding BorderBrush}"                            BorderThickness="{TemplateBinding BorderThickness}"                            CornerRadius="3" Width="{TemplateBinding Width}"&gt;                        &lt;Grid&gt;                            &lt;Grid.RowDefinitions&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                                &lt;RowDefinition Height="Auto"/&gt;                            &lt;/Grid.RowDefinitions&gt;                            &lt;Grid.ColumnDefinitions&gt;                                &lt;ColumnDefinition Width="150"/&gt;                                &lt;ColumnDefinition Width="*"/&gt;                            &lt;/Grid.ColumnDefinitions&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="0" Text="First Name:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="0" x:Name="txtFirstName"                                Text="{Binding Path=TheEmployee.FirstName, Mode=TwoWay}"/&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="1" Text="Last Name:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="1" x:Name="txtLastName"                                 Text="{Binding Path=TheEmployee.LastName, Mode=TwoWay}"/&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="2" Text="Birthday:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="2" x:Name="txtBirthday"                                 Text="{Binding Path=TheEmployee.Birthday, Mode=TwoWay}"/&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="3" Text="Group:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="3" x:Name="txtGroup"                                Text="{Binding Path=TheEmployee.Group, Mode=TwoWay}" /&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="4" Text="Phone No.:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="4" x:Name="txtPhoneNumber"                                 Text="{Binding Path=TheEmployee.PhoneNumber, Mode=TwoWay}" /&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="5" Text="Address:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="5"  x:Name="txtAddress"                                 Text="{Binding Path=TheEmployee.Address, Mode=TwoWay}"                                                                      AcceptsReturn="True" TextWrapping="Wrap"/&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="6" Text="Income:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="6" x:Name="txtIncome"                                 Text="{Binding Path=TheEmployee.Income, Mode=TwoWay}" /&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="7" Text="Tax:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="7" x:Name="txtTaxPercent"                                 Text="{Binding Path=TheEmployee.TaxPercent, Mode=TwoWay}" /&gt;                            &lt;TextBlock Grid.Column="0" Grid.Row="8" Text="National ID:" Style="{StaticResource tb}"/&gt;                            &lt;TextBox Grid.Column="1" Grid.Row="8" x:Name="txtNationalID"                                 Text="{Binding Path=TheEmployee.NationalID, Mode=TwoWay}"/&gt;                        &lt;/Grid&gt;                    &lt;/Border&gt;                &lt;/ControlTemplate&gt;            &lt;/Setter.Value&gt;        &lt;/Setter&gt;    &lt;/Style&gt;&lt;/ResourceDictionary&gt;</pre></td></tr></table></span></div></li>
          <li>Now that we've created the form control, we'll need to show it in the application and use it to display employee information. Open the "MainPage.xaml" file, locate the "LayoutRoot" Grid control, and paste the following XAML inside the Grid's content:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;my:EmployeeDataForm x:Name="edf" Margin="3" Width="450"     HorizontalAlignment="Left"    Grid.Column="1" IsLocked="True"     TheEmployee="{Binding Path=SelectedItem, ElementName=dg}"    BorderBrush="Black" BorderThickness="2"/&gt;</pre></td></tr></table></span></div></li>
          <li>Change the UserControl’s design width:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>    d:DesignWidth="860"</pre></td></tr></table></span></div></li>
          <li>Locate the DataGrid named "dg" and add a default event handler for the "SelectionChanged" event. Navigate to the event handler function and add the following code to it:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>edf.IsLocked = true;</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Select various employees from the data grid and look at their information. You'll notice that the form is enabled for edit, although we've set its "IsLocked" property to true. </li>
          <li>To make the form read only, we'll need to change the "IsReadOnly" property of each TextBox to "True". Since we might need to allow editing in the form, we won't automatically set the attribute to "True" in each TextBox. Instead we will base it on the "IsLocked" property of the template control. This can be achieved with a new feature of Silverlight 4. <b>Binding to Dependency Objects</b>. Open the "Generic.xaml" file from the "Themes" folder, and add the following XAML to every TextBox control in the file. You should have 9 of these elements:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>IsReadOnly="{Binding IsLocked}"</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Select various employees from the data grid and look at their information. You'll notice that this time, the form is read only.</li>
        </ol>
        <br />
        <a name="_Toc256193479" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Using Fallback Values &amp; String formatting</b>
        </p>
        <ol>
          <li>Run the application again, look at the form displaying the employee's information. The birthday is displayed as a long date/time format, the income doesn't state in which currency it is and the percentage of the tax is shown as a floating point instead of percentages. Usually we would format these values using a Converter, but with Silverlight 4 we have a new option: binding with StringFormat.</li>
          <li>Open the file "Generic.xaml" located in the "Themes" folder. Locate the TextBox bound to the "Birthday" property of the employee.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;TextBox Grid.Column="1" Grid.Row="2" x:Name="txtBirthday"      Text="{Binding Path=TheEmployee.Birthday, Mode=TwoWay}" IsReadOnly="{Binding IsLocked}"/&gt;</pre></td></tr></table></span></div></li>
          <li>Change the binding of the Text to the following binding:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.Birthday, Mode=TwoWay,  StringFormat='dddd, dd-MMMM-yyyy'}</pre></td></tr></table></span></div></li>
          <li>Find the TextBox for the "Income" property and change the binding as follows:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.Income, Mode=TwoWay,  StringFormat=C}"</pre></td></tr></table></span></div></li>
          <li>And the same for the "Tax" property:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.TaxPercent, Mode=TwoWay,  StringFormat=P}"</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. You'll notice that now the birthday is presented as a date, without the time, the salary is in dollars and the tax percentage is shown correctly. </li>
          <li>Return to Visual Studio and open the file "Employee.cs". This file contains the data structure of the Employee and Executive classes. As you can see, the Executive class, which derives from the Employee class has a "ManagedEmployees" property which holds the number of employees the executive is responsible for. To show this property in the DataGrid, open the file "MainPage.xaml", locate the DataGrid named "dg" and add the following XAML after the second "DataGridTextColumn" element:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;DataControls:DataGridTextColumn Binding="{Binding ManagedEmployees}" Header="Emps." Width="0.2*" /&gt;</pre></td></tr></table></span></div></li>
          <li>Since the width of the columns doesn't add to 1, change the width of the second column from "0.6*" to "0.4*"<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;DataControls:DataGridTextColumn Binding="{Binding LastName}"     Header="Last Name" Width="0.4*"/&gt;</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. You'll notice that only two employees are executives and the others have no value display in the "Emps" column.</li>
          <li>We want employees that are not executives to have "N/A" displayed in their "Managed Emp." column, in order to clarify that they are not executives. Because "Employee" instances don't have the property "ManagedEmployees", we cannot use a converter. Therefore, we will use the new "FallbackValue" support in Silverlight 4 that allows us to declare default values for cases where binding is unsuccessful (for example – when the bound object doesn't have the property name we are looking for). Locate the DataGrid named "dg" and change the binding of the "ManagedEmployees" property to the following Binding:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Binding="{Binding ManagedEmployees, FallbackValue=N/A}"</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. This time you'll notice that all the employees which are not executives have the value "N/A" (not-available).</li>
        </ol>
        <a name="_Toc256193480" href="#">
          <span />
        </a>
        <p>
          <b>Task 3– Validating with IDataErrorInfo</b>
        </p>
        <ol>
          <li>Now that we can display the employees' information, we'll add some editing support starting with Update. For updating we only need to unlock the form control. Open the file "MainPage.xaml" and locate the button named "btnUpdate". Add a default event handler for the button's "Click" event and navigate to the event handler function. Add the following code to the function:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>edf.IsLocked = false;</pre></td></tr></table></span></div></li>
          <li>Next, we'll add delete support. Open the file "MainPage.xaml" and locate the button named "btnDelete". Add a default event handler for the button's "Click" event and navigate to the event handler function. Add the following code to the function:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>EmployeesManager em = this.Resources["employeeManagerViewSource"] as EmployeesManager;em.Employees.Remove(dg.SelectedItem as Employee);</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Try to update and delete an employee from the list. </li>
          <li>To add support for adding new employees, we will use a popup window that will display the employee data form which we've already created. Right-click the EmployeeManager project and select <b>Add Existing Item…</b><p><img src="images\4600ca03-7c42-454b-827d-0c251f71ea14.png" /></p><p><b>Figure 3</b><br /><i> Add Existing Item to the Project</i></p></li>
          <li>In the "Add Existing Item – EmployeeManager" window, locate the lab installation folder, navigate to “\Helpers” folder, select the file "NewEmployee.xaml" and press "Add". You'll notice that in addition to the "NewEmployee.xaml" file, Visual Studio added the "NewEmployee.xaml.cs" file<p><img src="images\a2822490-c667-4ffc-809f-3d6543b29b40.png" /></p><p><b>Figure 4</b><br /><i> New Items in the Project</i></p></li>
          <li>Open both files (XAML file and code file) and familiarize yourself with them. As you can see, this is a simple implementation of a ChildWindow control, introduced in Silverlight 3.</li>
          <li>Open the file "MainPage.xaml" and locate the button named "btnNew". Add a default event handler for the button's "Click" event and navigate to the event handler's function.</li>
          <li>Add the following code to the event handler function<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>NewEmployee cw = new NewEmployee();EmployeeDataForm employeeDataForm = new EmployeeDataForm();employeeDataForm.Margin = new Thickness(3);employeeDataForm.Width = 450;employeeDataForm.TheEmployee = new Employee();employeeDataForm.IsLocked = false;cw.LayoutRoot.Children.Add(employeeDataForm);cw.HasCloseButton = false;cw.Title = "New Employee Details";cw.Show();</pre></td></tr></table></span></div></li>
          <li>Before we compile and run, we need to add the newly created employee to the data grid. Add the following code before calling the "Show" method: <div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>cw.Closed += (s, args) =&gt;{    if (cw.DialogResult.Value &amp;&amp; employeeDataForm.IsValid)    {        EmployeesManager em = this.Resources["employeeManagerViewSource"]           as EmployeesManager;        em.Employees.Add(employeeDataForm.TheEmployee);    }};</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Press the "New" button. A popup window will appear with the employee data form in it. As you can see, there are no validations on the data and no default values except for the CLR defaults.</li>
          <li>Open the file "Generic.xaml" located in the "Themes" folder. Look for the TextBox which is bound to the "Group" property. We would like to set the value of this property to "General" for all new employees. To do that we will use the new Binding feature in Silverlight 4: TargetNullValue. Replace the binding XAML in the TextBox with the following XAML:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.Group, Mode=TwoWay, TargetNullValue=General}"</pre></td></tr></table></span></div></li>
          <li>Next, we'll change the default value (using TargetNullValue) for the "NationalID" property. Locate the TextBox that is bounded to this property (should be the last TextBox element in the file) and replace the binding with the following binding:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.NationalID, Mode=TwoWay,TargetNullValue=0000000000}"</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Press the "New" buttons and you'll notice that the "National ID" field is set to "0000000000" and the group is set to "General".</li>
          <li>In addition to default values we would like to validate the employee information that is entered. To do that we'll change the Employee's class properties by adding validation and exception code and by using the ValidatesOnExceptions attribute.  We'll also add in a new feature introduced in Silverlight 4: the<b> IDataErrorInfo </b>interface. Open the file "Employee.cs" and change the class declaration to the following declaration:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class Employee : INotifyPropertyChanged, IDataErrorInfo</pre></td></tr></table></span></div></li>
          <li>Right click the "IDataErrorInfo" interface, and from the context menu select "<b>Implement Interface  Implement Interface</b>"<p><img src="images\43525536-a5eb-41a9-b6d2-06eb4cd3f041.png" /></p><p><b>Figure 5</b><br /><i> Automatic Interface Implementation</i></p></li>
          <li>This generates the code for the Error and this[] properties. </li>
          <li>Replace generated Error and this[] properties with the following code<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>string errors = null;public string Error{    get { return errors; }}public string this[string columnName]{    get    {        string result = null;        if (columnName == "FirstName")        {            if (String.IsNullOrEmpty(FirstName))                result = "Firstname has to be set!";            else if (FirstName.Length &lt; 3)                result = "Firstname's length has to be at least 5 characters!";        }        else if (columnName == "LastName")        {            if (String.IsNullOrEmpty(LastName))                result = "LastName has to be set!";            else if (LastName.Length &lt; 3)                result = "LastName's length has to be at least 5 characters!";        }        else if (columnName == "Income")        {            if (Income &lt;= 0)                result = "The income has to be positive!";        }        else if (columnName == "TaxPercent")        {            if (TaxPercent &lt;= 0)                result = "The tax has to be positive!";            else if (TaxPercent &gt;= 1)                TaxPercent /= 100;        }        else if (columnName == "NationalID")        {            if (null != NationalID)                if (NationalID.Length &lt; 10 || NationalID.Length &gt; 12)                    result = "National ID is wrong!";        }        return result;    }}</pre></td></tr></table></span></div></li>
          <li>Now that we have implemented the IDataErrorInfo interface, we can tell the various bindings to check for validation errors. Open the file "Generic.xaml" located in the "Themes" folder. Find the TextBox which is bound to the "FirstName" property (it should be the first TextBox) and replace its binding to the following: <div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.FirstName, Mode=TwoWay, ValidatesOnDataErrors=True}</pre></td></tr></table></span></div></li>
          <li>Find the TextBox for the "LastName" property and change the binding to:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.LastName, Mode=TwoWay, ValidatesOnDataErrors=True}"</pre></td></tr></table></span></div></li>
          <li>Find the TextBox for the "Income" property and change the binding to:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.Income, Mode=TwoWay,StringFormat=C, ValidatesOnDataErrors=True}"</pre></td></tr></table></span></div></li>
          <li>Find the TextBox for the "TaxPercent" property and change the binding to:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.TaxPercent, Mode=TwoWay,StringFormat=P, ValidatesOnDataErrors=True}"</pre></td></tr></table></span></div></li>
          <li>Find the TextBox for the " NationalID" property – change the binding to:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XAML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Text="{Binding Path=TheEmployee.NationalID, Mode=TwoWay,ValidatesOnDataErrors=True}"</pre></td></tr></table></span></div></li>
          <li>All that is left is to verify the employee's information when we input a new employee. Open the file "MainPage.xaml.cs" and locate the event handler function "btnNew_Click". Add the following code before the "Show" method:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>cw.Closing += (s, args) =&gt;{if (!employeeDataForm.IsValid &amp;&amp; cw.DialogResult.Value){MessageBox.Show("Some of field values are not valid.\nPlease fix all marked fields and try again");args.Cancel = true;}};</pre></td></tr></table></span></div></li>
          <li>Compile and run the application. Press the "New" button. Examine the different validation messages you get (note that you may need to remove the % character when entering the Tax Percent value in order for it to validate). Try to add an employee without fulfilling all the validation requirements.</li>
        </ol>
        <br />
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to jopapa@microsoft.com<p />Copyright © 2010 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>